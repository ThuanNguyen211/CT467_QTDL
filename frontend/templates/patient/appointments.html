{% extends 'base_patient.html' %}
{% block title %}Lịch hẹn của tôi{% endblock %}
{% block content %}
<h2>Lịch hẹn của tôi</h2>
<a href="/patient/appointments/new" class="btn btn-success mb-3">Đặt lịch mới</a>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>Bác sĩ</th><th>Ngày</th><th>Giờ</th><th>Trạng thái</th><th>Hành động</th>
    </tr>
  </thead>
  <tbody>
    {% for appt in appointments %}
    <tr>
      <td>{{ appt.ten_bac_si }}</td>
      <td>{{ appt.ngay_hen }}</td>
      <td>{{ appt.gio_hen }}</td>
      <td>{{ appt.trang_thai }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<script>
document.addEventListener('DOMContentLoaded', async function() {
  const ma_benh_nhan = localStorage.getItem('ma_benh_nhan');
  if (!ma_benh_nhan) {
    alert('Không tìm thấy mã bệnh nhân!');
    return;
  }
  const response = await fetch(`http://127.0.0.1:5000/booking/my_booking?ma_benh_nhan=${ma_benh_nhan}`);
  const data = await response.json();

  const tbody = document.querySelector('table tbody');
  tbody.innerHTML = '';
  data.forEach(appt => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${appt.ten_bac_si}</td>
      <td>${appt.ngay_hen}</td>
      <td>${appt.gio_hen}</td>
      <td>${appt.trang_thai}</td>
    `;
    tbody.appendChild(tr);
  });
});
</script>
{% endblock %} 