{% extends 'base_doctor.html' %}
{% block title %}Lịch sử Phiếu Khám{% endblock %}
{% block content %}
<h2>Lịch sử Phiếu Khám</h2>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>Mã phiếu</th><th>Bệnh nhân</th><th>Ngày khám</th><th>Triệu chứng</th><th>Chẩn đoán</th>
    </tr>
  </thead>
  <tbody>
    {% for exam in examinations %}
    <tr>
      <td>{{ exam.ma_phieu_kham }}</td>
      <td>{{ exam.ten_benh_nhan }}</td>
      <td>{{ exam.ngay_kham }}</td>
      <td>{{ exam.trieu_chung }}</td>
      <td>{{ exam.chan_doan }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
  document.addEventListener('DOMContentLoaded', async function () {
      const ma_bac_si = localStorage.getItem('ma_bac_si');
      if (!ma_bac_si) {
        alert('Không tìm thấy mã bác sĩ!');
        return;
      }
      const response = await fetch(`http://127.0.0.1:5000/doctors/patients?ma_bac_si=${ma_bac_si}`);
      const data = await response.json();

      const tbody = document.querySelector('table tbody');
      tbody.innerHTML = '';
      data.forEach(exam => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
      <td>${exam.ma_phieu_kham}</td>
      <td>${exam.ten_benh_nhan}</td>
      <td>${exam.ngay_kham}</td>
      <td>${exam.trieu_chung}</td>
      <td>${exam.chan_doan}</td>
    `;
        tbody.appendChild(tr);
      });
    });
</script>
{% endblock %} 