{% extends 'base_doctor.html' %}
{% block title %}Lịch hẹn của tôi{% endblock %}
{% block content %}
<h2>Lịch hẹn của tôi</h2>
<div id="appointments-table"></div>
<script>
  var ma_bac_si = localStorage.getItem('ma_bac_si');
  if (ma_bac_si) {
    fetch('http://localhost:5000/doctors/appointments?ma_bac_si=' + ma_bac_si)
      .then(response => response.json())
      .then(data => {
        let rows = data.map(appt => `
          <tr>
            <td>${appt.ten_benh_nhan}</td>
            <td>${appt.ngay_hen}</td>
            <td>${appt.gio_hen}</td>
            <td>${appt.trang_thai}</td>
            <td>
              ${appt.trang_thai === 'Chờ khám' ? `<a href="/doctor/examinations/new?appointment_id=${appt.ma_lich_hen}" class="btn btn-sm btn-success">Tạo phiếu khám</a>` : ''}
            </td>
          </tr>
        `).join('');
        document.getElementById('appointments-table').innerHTML = `
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>BN</th><th>Ngày</th><th>Giờ</th><th>Trạng thái</th><th>Hành động</th>
              </tr>
            </thead>
            <tbody>
              ${rows}
            </tbody>
          </table>
        `;
      });
  } else {
    document.getElementById('appointments-table').innerHTML = "<p>Không tìm thấy mã bác sĩ trong localStorage.</p>";
  }
</script>
{% endblock %}